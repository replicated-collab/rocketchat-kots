apiVersion: kots.io/v1beta1
kind: HelmChart
metadata:
  name: rocketchat
spec:
  chart:
    name: rocketchat
    chartVersion: f3b947c
  values:
    host: "repl{{ LicenseFieldValue `license_url`}}"
    mongodb:
      auth:
        username: rocketchat
        password: "repl{{ ConfigOption `mongo_rocketchat_password`}}"
        database:  rocketchat
        rootPassword: "repl{{ ConfigOption `mongo_root_password`}}"
  optionalValues:
    - when: '{{repl ConfigOptionEquals "mongo_type" "external_mongodb"}}'
      values: 
        externalMongodbUrl: "repl{{ ConfigOption `mongo_external_url`}}"
        externalMongodbOplogUrl: "repl{{ ConfigOption `mongo_external_oplog_url`}}"
        mongodb: 
          enabled: false
    - when: '{{repl ConfigOptionEquals "mongo_type" "embedded_mongodb"}}'
      values: 
        mongodb:
          auth:
            username: rocketchat
            password: "repl{{ ConfigOption `mongo_rocketchat_password`}}"
            database:  rocketchat
            rootPassword: "repl{{ ConfigOption `mongo_root_password`}}"

  useHelmInstall: true
